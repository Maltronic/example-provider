language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
    - PACT_BROKER_BASE_URL=https://metaclass.pact.dius.com.au
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
    # Encrypted PACT_BROKER_TOKEN
    - secure: "ZP6EcJvuDrvC6axmqhoZXKBTZDfz7U1BTi6ZEGjatpGbH4dc82SKGzOAOkvjC40LbqmMMVzjYyt7Uq/TM/V57/i6vCZ5eH8FSgN1U3E9opKzUEv2SPnvoa9n99q1+13Ut1tKpuYmfJlVXjKOXpe0eZt+fVzUUjxdgKfRgSbNr6//XzlQHmXJ6KhLuMaepqqHLfxa56KnRGgmVN/wjDYqsjt+jcpmTpZuuLoUXRgbYBoIj7Td7nzQIpRKJ+ZnT1Jl/gAsak7giqaVFBsooixRnM2eVdxpDRcn2ZrPIDgB1ck5UDBnNjp6Oarnr1TXX5G4KJMi8u/E6s03UvzuqMpacO82U66YOmxGGMHHdepnPOaZJX84JZIGXkylxpHlIuKnRsbZWVeVTr55TCGLmCjVsjz+i0kGrAZlmZ2fwxgjO7/hSfdqGoZLqONZ6uT9qgtIoNhn+tysmduzO9vCJwYhJ31zszhgwVkFj/mkCaDqQhZvmciK+XUJlUS/KMFYSnN6A6QrkSV5TA8Q00VmykKAJebbaxA5GC3UEE9S/GqXnViaY2XM78mhzgGaQrW9rREVxWnW0jsuu7h8WNvC40IO8N/9sVTb0V0ZLvgjREDECmxmocAvpP0r3DgBjWsn5vfRVL7n5x4a56P1EjBA1bNIMG6RWGKpPCxSQep8cCtZJTI="
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
